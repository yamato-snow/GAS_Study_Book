## 7. デバッグとエラーハンドリング

GASのスクリプトを開発する際、バグを見つけて修正することは重要です。この章では、デバッグとエラーハンドリングの方法を説明します。

### 7.1 ログ出力とデバッグ

`Logger.log()`を使ってログを出力することで、スクリプトの実行状況を確認できます。ログはスクリプトエディタの「ログ」タブで確認できます。

```javascript
function debugFunction() {
  const x = 10;
  const y = 20;
  const z = x + y;
  Logger.log("x = %s, y = %s, z = %s", x, y, z);
}
```

上記の例では、`Logger.log()`を使って変数の値をログに出力しています。

デバッグのためには、ブレークポイントを設定することもできます。スクリプトエディタの行番号の左側をクリックすると、ブレークポイントを設定できます。ブレークポイントを設定した状態でスクリプトを実行すると、その行で実行が一時停止するので、変数の値を確認したりステップ実行したりできます。

### 7.2 よくあるエラーと対処法

GASを使っていると、よくあるエラーにぶつかることがあります。代表的なエラーと対処法を以下に示します。

1. "ReferenceError: 〜 is not defined"
   - 変数や関数が定義されていない場合に発生します。スペルミスがないか確認し、変数や関数を正しく定義してください。

2. "TypeError: Cannot read property '〜' of undefined"
   - オブジェクトが未定義の状態でプロパティにアクセスしようとすると発生します。オブジェクトが正しく初期化されているか確認してください。

3. "Authorization is required to perform that action."
   - スクリプトの実行に必要な権限が不足している場合に発生します。スクリプトの権限設定を見直し、必要な権限を与えてください。

4. "Service invoked too many times for one day: 〜."
   - サービスの1日の利用制限を超えた場合に発生します。利用制限を確認し、必要に応じてスクリプトの実行頻度を調整してください。

### 7.3 例外処理（try-catch文）

想定外のエラーが発生した場合、スクリプトの実行が途中で停止してしまうことがあります。これを防ぐために、例外処理を使います。

```javascript
function exceptionHandling() {
  try {
    // エラーが発生する可能性のある処理
    const value = undefined;
    console.log(value.property);
  } catch (e) {
    // エラーが発生した場合の処理
    Logger.log("Error: " + e.message);
  } finally {
    // エラーの有無に関わらず実行する処理
    Logger.log("処理が完了しました。");
  }
}
```

上記の例では、`try`ブロック内でエラーが発生する可能性のある処理を実行し、エラーが発生した場合は`catch`ブロックで例外を処理しています。`finally`ブロックには、エラーの有無に関わらず実行する処理を記述します。

### 7.4 練習問題
1. 2つの数値を引数として受け取り、除算を行う関数を作成してください。ただし、0で除算しようとした場合にエラーを適切に処理するようにしてください。
2. スプレッドシートのA1セルに入力された文字列を大文字に変換する関数を作成してください。ただし、セルが空の場合やセルの値が文字列でない場合にエラーを適切に処理するようにしてください。
3. 外部APIを呼び出す関数を作成し、APIのレスポンスをスプレッドシートに書き出してください。ただし、APIの呼び出しが失敗した場合にエラーを適切に処理するようにしてください。

(続く)